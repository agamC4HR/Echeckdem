@using Microsoft.AspNetCore.Http
@* @inject IHttpContextAccessor HttpContextAccessor
 *@
<!DOCTYPE html>
<html lang="en">

<head>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    @*  <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script> *@
    <script src="~/js/site.js" asp-append-version="true"></script>
    

    <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
    @* <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    
    <link href="~/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/lib/bootstrap/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
    <link href="~/lib/bootstrap/dist/css/bootstrap.rtl.css" rel="stylesheet" />
    <link href="~/lib/bootstrap/dist/css/bootstrap.css" rel="stylesheet" /> *@
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Echeckdem</title>
@*     <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" /> *@
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    @* <link rel="stylesheet" href="~/Echeckdem.styles.css" asp-append-version="true" /> *@
  


   


</head> 
<body>
@*     @{
        var userLevel = Context.Session.GetInt32("UserLevel");
    }  *@

    



    <div class="main_parent">
    <nav class="navbar">
        <div class="nav_parent">
            <div class="nav_logo">
                <a href="/Home">
                    <div class="nav_image">
                        <img src="~/imgs/eCheckwhite.png" alt="" class="product_logo"/>
                    </div>
                </a>
            </div>
            <div class="nav-links">
                <div class="nav_links">
                    <a href="/Home"> Home</a>
                  

                       

                        @if (Context.Session.GetInt32("User Level") == 1)
                        {
                            <div class="custom-dropdown">
                                <button class="dropdown-toggle" onclick="toggleDropdown(this)">Client Mgmt</button>
                                <div class="dropdown-content">
                                    <a href="/OrganisationSetup/OrganisationSetup">Client Setup</a>
                                    <a href="/SiteManagement/Index">Manage Sites</a>
                                    <a href="/UserManagement/Index">Manager User</a>
                                </div>
                            </div>

                            <div class="custom-dropdown">
                                <button class="dropdown-toggle" onclick="toggleDropdown(this)">Compliance Setup</button>
                                <div class="dropdown-content">
                                    <a href="/StateTemplate/Index">State Template</a>
                                    <a href="/ActScopeSetup/Index">BOCW Scope Setup</a>
                                    <a href="/TrackScopeSetup/Index">Track Scope Setup</a>
                                </div>
                            </div>

                            <div class="custom-dropdown">
                                <button class="dropdown-toggle" onclick="toggleDropdown(this)">Reports</button>
                                <div class="dropdown-content">
                                    <a href="/DetailsView/Index">Compliance Tracker</a>
                                    <a href="/Tracker/Trackerlist">On-Going Activity</a>
                                    @if(Context.Session.GetString("BO") == "yes")

                                    {
                                    <a href="/Project/Index">Construction Tracker</a>
                                    }
                                </div>
                            </div>

                            @* <h2>User Level: @ViewBag.UserLevel</h2> *@
                            @* <a href="/SiteManagement/Index">Manage Sites</a>
                            <a href="/OrganisationSetup/OrganisationSetup">Client Setup</a> *@
                           @*  <a href="/ActScopeSetup/Index">BOCW Scope Setup</a>
                            <a href= "/TrackScopeSetup/Index">Track Scope Setup</a> *@
                            @* <a href="/UserManagement/Index">User Management</a> *@
                            
                            @* <a href="/StateTemplate/Index">State Template</a> *@
                            @* <a href="/DetailsView/Index">Compliance Tracker </a>
                            <a href="/Tracker/Trackerlist">On-Going Activity</a>
                            <a href="/Project/Index">Construction Tracker</a> *@
                        }
                        else
                        {

                            <a href="/DetailsView/Index">Compliance Tracker </a>
                            <a href="/Tracker/Trackerlist">On-Going Activity</a>
                            
                            if(Context.Session.GetString("BO") == "yes")
                            
                            {
                                <a href="/Project/Index">Construction Tracker</a>

                            }
                          


                        }
                    </div>
            </div>

                @{
                    var userID = Context.Session.GetString("userID");
                    var initial = !string.IsNullOrEmpty(userID) ? userID.Trim()[0].ToString().ToUpper() : "?";

                }

                <div class="custom-dropdown" style="right:20px; align-content:center;">
                    <button class="dropdown-toggle" onclick="toggleDropdown(this)">@Context.Session.GetString("userID")</button>
                    <div class="dropdown-content" style="right:45px;">
                        <a href="#">Change Password</a>
                        <form asp-action="Logout" asp-controller="Login" method="post" class="Logout-form">
                            <a> <button type="submit" class="Logout-button">Logout</button> </a>
                        </form>
                    </div>
                </div>

               @*  <div class="custom-dropdown" style="right:20px; align-content:center;">
                    <button class="dropdown-toggle" onclick="toggleDropdown(this)">
                        @initial
                    </button>
                    <div class="dropdown-content" style="margin-left:110px;">
                        <a href="#">Change Password</a>
                        <form asp-action="Logout" asp-controller="Login" method="post" class="Logout-form">
                            <button type="submit" class="Logout-button">Logout</button>
                        </form>
                    </div>
                </div> *@

                @*  <a href=""> Settings</a> *@
               @*  <form asp-action="Logout" asp-controller="Login" method="post" class="Logout-form">
                    <button type="submit" class="Logout-button">Logout</button>
                </form> *@


               



            
    </nav>
        <div class="heading_background_parent">
            <div class="heading_background">
                <div class="heading-grandparent">
            <div class="heading_parent">
                        <h1 class="heading"> @Html.Raw(ViewData["Heading"]) </h1>
                        <p class="heading_child">@Html.Raw(ViewData["Heading_child"]) </p>
                </div>
                    @if (ViewData["Title"]?.ToString() == "Compliance Tracker")
                    {
                        <div class="cond-act-buttons">
                        <button class="filter-btn" onclick="toggleFilterForm()">
                            FILTER
                        </button>
                            <div style="width: 10px;"></div>
                        <button class="table-export-btn" onclick="downloadData()">
                            EXPORT
                        </button>
                        </div>
                    }

                    @if (ViewData["Title"]?.ToString() == "Organisation List")
                    {
                        <button class="table-add-btn" onclick="showAddOrganisationForm()">
                            Add New Organisation
                        </button>
                    }
                    @if (ViewData["Title"]?.ToString() == "On-Going Activities" && Context.Session.GetInt32("User Level") <= 2)
                    {
                        <a href="@Url.ActionLink("Index","Tracker")" class="table-add-btn" >
                            Add New Item
                        </a>
                    }
                    @if (ViewData["Title"]?.ToString() == "Activity Details")
                    {
                        <button class="table-add-btn" onclick="backToTracker()">
                            Back to Tracker
                        </button>
                    }
                    @if (ViewData["Title"]?.ToString() == "Templates for State")
                    {
                        <button type="button" class="table-add-btn" id="addTemplateBtn">
                            Add New Template
                        </button>
                    }

                    @if (ViewData["Title"]?.ToString() == "Returns Templates for State")
                    {
                        <button type="button" class="table-add-btn" id="addTemplateBtn">
                            Add New Template
                        </button>
                    }
                </div>
                </div>
        </div>
        <div class="main_child">
            @if (
               @*  ViewData["Title"]?.ToString() == "Organisation List" ||  *@
            ViewData["Title"]?.ToString() == "BOCW Scope Setup" || ViewData["Title"]?.ToString() == "Track Scope Setup" || ViewData["Title"]?.ToString() == "User List" || ViewData["Title"]?.ToString() == "State Template")
            {
                <div class="table-heading-container">
                    @RenderSection("TableHeadingContent", required: false)
                    

                </div>
            }
           @*  @if (ViewData["Title"]?.ToString() == "Organisation List")
            {
                <div class="table-container">
                    @RenderSection("TableContent", required: false)
                </div>
            } *@
            @RenderBody()
        </div>
    </div>

    

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">


    @await RenderSectionAsync("Scripts", required: false)

</body>
</html>

<script>
    function toggleDropdown(button) {
        // Close all dropdowns first
        document.querySelectorAll('.dropdown-content').forEach(drop => {
            if (drop !== button.nextElementSibling) {
                drop.style.display = 'none';
            }
        });

        // Toggle the clicked dropdown
        const dropdown = button.nextElementSibling;
        dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
    }

    // Close dropdowns when clicking outside
    window.addEventListener('click', function (e) {
        if (!e.target.matches('.dropdown-toggle')) {
            document.querySelectorAll('.dropdown-content').forEach(drop => {
                drop.style.display = 'none';
            });
        }
    });
</script>


    