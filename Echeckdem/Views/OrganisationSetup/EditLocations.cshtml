@model Echeckdem.CustomFolder.CombinedOrganisationSetupViewModel

<style>
    .locationDataTable {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
        font-size: 16px;
        color: #333;
        background-color: #fff;
    }

        .locationDataTable thead {
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .locationDataTable th,
        .locationDataTable td {
            padding: 12px;
            text-align: left;
            border: 1px solid #dee2e6;
            font-size: 12px;
        }

        .locationDataTable th {
            font-weight: bold;
            text-transform: uppercase;
           
            color: #495057;
        }

        .locationDataTable tbody tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .locationDataTable tbody tr:hover {
            background-color: #e9ecef;
        }


    /* Form */
    .locationDataForm {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        padding: 20px;
        font-size: 16px;
        line-height: 1.6;
    }



        .locationDataForm label {
        font-weight: bold;
        color: #dd3432;
        padding-right: 10px;
    }

        .locationDataForm input, .locationDataForm select {
        padding: 10px;
        font-size: 14px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

        .locationDataForm button {
        padding: 5px;
        font-size: 12px;
        font-weight: bold;
        background-color: white;
        color: #dd3432;
        border: 2px solid #dd3432;
    }

            .locationDataForm button:hover {
            background-color: #dd3432;
            color: white;
        }

</style>


@if (TempData["SuccessMessage"] != null)
{
    <div class="locationDataSuccessMessage">
        @TempData["SuccessMessage"]
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="locationDataErrorMessage">
        @TempData["ErrorMessage"]
    </div>
}

<table class="locationDataTable" id="locationDataTable">
    <thead>
        <tr>
            @* <th>Oid</th> *@
            <th>Location Code</th>
            <th>Location Name</th>
            <th>City</th>
            <th>State</th>
            <th>Region</th>
            <th>Central Govt</th>
            <th>CLRA</th>
            <th>Active</th>
            <th>Site Under</th>
            <th>Edit</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var location in Model.AddLocation)
        {
            <tr>
                <td data-field="Oid" style="display: none;">@location.Oid</td>
                <td  data-field="Lcode">@location.Lcode</td>
                <td  data-field="Lname">@location.Lname</td>
                <td  data-field="Lcity">@location.Lcity</td>
                <td  data-field="Lstate">@location.Lstate</td>
                <td  data-field="Lregion">@location.Lregion</td>
                <td  data-field="Iscentral">
                    @(location.Iscentral.HasValue ? (location.Iscentral == 1 ? "Yes" : "No") : "N/A")
                <td  data-field="Iscloc">
                    @(location.Iscloc.HasValue ? (location.Iscloc == 1 ? "Yes" : "No") : "N/A")
                </td>
                <td data-field="Lactive">
                    @(location.Lactive.HasValue ? (location.Lactive == 1 ? "Yes" : "No") : "N/A")
                </td>
                <td data-field="Ltype">
                        @* @location.Ltype *@
                        @location.LtypeDescription
                </td>
                <td>
                    <i class="fas fa-pen edit-icon" style="color: #dd3432; font-size: 14px; cursor: pointer;"></i>
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- Edit Location Modal -->
<div class="modal" id="editLocationModal" style="display:none; ">
    <div class="modal-dialog" role="document">
        <div class="modal-content">

            <form class="locationDataForm" id="editLocationForm" method="post">
                <input type="hidden" asp-for="Oid" />
                <input type="hidden"  id="locationId" name="locationId" />

            
                    <label for="Lcode">Location Code</label>
                    <input type="text" id="Lcode" name="Lcode" placeholder="Enter location code" required />
                

                
                    <label for="Lname">Location Name</label>
                    <input type="text" id="Lname" name="Lname" placeholder="Enter location name" required />
               

                
                    <label for="Lcity">City</label>
                    <input type="text" id="Lcity" name="Lcity" placeholder="Enter city name" required />
                

               
                    <label for="Lstate">State</label>
                    <input type="text" class="form-control" id="Lstate" name="Lstate" placeholder="Enter state name" required />
               

                
                    <label for="Lregion">Region</label>
                    <input type="text" id="Lregion" name="Lregion" placeholder="Enter region name" required />
                

                
                    <label for="Iscentral">Is Central</label>
                    <select id="Iscentral" name="Iscentral">
                        <option value="" selected>-- Select --</option>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                


                
                    <label for="Iscloc">Is CLOC</label>
                    <select id="Iscloc" name="Iscloc">
                        <option value="" selected>-- Select --</option>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                

               
                    <label for="Lactive">Active</label>
                    <select id="Lactive" name="Lactive">
                        <option value="" selected>-- Select --</option>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
           
      
                <button type="submit" class="btn ">Save Changes</button>
                <button type="button" class="close-btn">Cancel</button>
                
          
            </form>
                

        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        var oid = "";
        // Populate the modal with data
        $('.edit-icon').on('click', function () {

            var row = $(this).closest('tr');
            oid = row.find('td[data-field="Oid"]').text().trim(); // Set the global OID value
            @* alert("Oid value: " + oid); *@


            var locationId = row.data('id'); // Assuming data-id attribute for location ID
            var Lcode = row.find('td[data-field="Lcode"]').text();
            var Lname = row.find('td[data-field="Lname"]').text();
            var Lcity = row.find('td[data-field="Lcity"]').text();
            var Lstate = row.find('td[data-field="Lstate"]').text();
            var Lregion = row.find('td[data-field="Lregion"]').text();
            var Iscentral = row.find('td[data-field="Iscentral"]').text().includes("Yes") ? 1 : 0;
            var Iscloc = row.find('td[data-field="Iscloc"]').text().includes("Yes") ? 1 : 0;
            var Lactive = row.find('td[data-field="Lactive"]').text().includes("Yes") ? 1 : 0;


            // Populate modal fields
            $('#locationId').val(locationId);
            $('#Lcode').val(Lcode);
            $('#Lname').val(Lname);
            $('#Lcity').val(Lcity);
            $('#Lstate').val(Lstate);
            $('#Lregion').val(Lregion);
            $('#Iscentral').val(Iscentral);
            $('#Iscloc').val(Iscloc);
            $('#Lactive').val(Lactive);

            $('#editLocationModal').css('display', 'block');
            $('#locationDataTable').css('display', 'none');
        });

        $('.close-btn').on('click', function () {
            $('#editLocationModal').css('display', 'none');
            $('#locationDataTable').css('display', 'table');
        });

        // Handle form submission
        $('#editLocationForm').on('submit', function (e) {
            e.preventDefault(); 

            var formData = new FormData(this); 
            
            $.ajax({
                type: "POST",
                url: '@Url.Action("UpdateLocations", "OrganisationSetup")', // Use form's action attribute 
                data: formData,
                contentType: false,
                processData: false,
                success: function (response) {
                    // Handle success
                    
                    alert('Location updated successfully!');
                    $('#editLocationModal').css('display', 'none');
                    $("#orgDetailsBody").load(`/OrganisationSetup/GetLocationDatabyOid?oid=${oid}`);
                },
                error: function (xhr, status, error) {
                    console.error('XHR:', xhr);
                    console.error('Status:', status);
                    console.error('Error:', error);
                    alert('Error updating location: ' + xhr.responseText || error);
                }
            });
        });

    });
</script>
