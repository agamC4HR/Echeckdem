@model List<Ncmlocbo>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<table class="org-details-body-table" id="bodetailsdata">
    <thead>
        <tr>
            <th>Location Code</th>
            <th>Project Code</th>
            <th>Client Name</th>
            <th>Project Address</th>
            <th>Nature of Work</th>
            <th>Project Cost</th>
            
            
        </tr>
    </thead>
    <tbody id="boDetailsTable">
        @foreach (var bo in Model)
        {
            <tr>
                <td>@bo.Lcode</td>
                <td>@bo.ProjectCode</td>
                <td>@bo.ClientName</td>
                <td>@bo.ProjectAddress</td>
                <td>@bo.NatureofWork</td>
                <td>@bo.ProjectCostEst</td>
               
               
            </tr>
          
        }
       
    </tbody>
</table>

<!-- Container to load the partial view -->
<div id="mapScopesContainer"></div>

<script>
    // Event listener for the "Map Scopes" button
    $(document).on('click', '.map-scopes-btn', function () {
        const lcode = $(this).data('lcode'); // Get Lcode from data attribute
        const projectCode = $(this).data('projectcode'); // Get ProjectCode from data attribute

        console.log("Loading scopes for Lcode:", lcode, "and ProjectCode:", projectCode); // Debugging line

        // Show a loading spinner in the container
        $('#mapScopesContainer').html('<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>');

        // Perform an AJAX request to load the partial view
        $.get('@Url.Action("MapScopes", "OrganisationSetup")', { lcode: lcode, projectCode: projectCode })
            .done(function (data) {
                if (data) {
                    $('#mapScopesContainer').html(data); // Insert the partial view into the container
                } else {
                    alert("Failed to load scopes. Please try again."); // User feedback on failure
                }
            })
            .fail(function (xhr, status, error) {
                console.error("AJAX Error:", error); // Debugging line for failed request
                alert(`Error: ${xhr.responseText || "Unable to process the request."}`); // Show error to the user
            });
    });
</script>
